# TY-302 조명 제어 시스템 + LoRa 통신
----
##  ** 프로젝트 설명 및 현 상황 **
### TY-302 조명 제어 시스템은 PIR 센서와 CDS 센서를 사용하여 주변 환경과 사람의 움직임을 감지해 조명을 자동으로 제어
### 또한 LoRa 통신 모듈을 통해 원격으로 상태 및 오류 메시지를 전송하여 시스템의 상태를 모니터링
###  LoRa 게이트웨이 등록 문제
### TTN (The Things Network)에 LoRa 게이트웨이를 등록하려고 시도했으나, 이미 동일한 게이트웨이 EUI가 등록되어있음
## 해결방안 [게이트웨이 관리 권한 요청 받아야함]
### 방수등 동작 문제
### P1와 P2 핀에 SSR 릴레이와 방수등이 연결되었으며, 동작 코드와 핀 설정은 모두 정상
### MCU에서 GPIO 상태를 통해 방수등 ON 명령이 정상적으로 전달되었지만, 실제 조명이 켜지지않음
## 해결방안 [멀티미터를 사용하여 P1과 P2 출력 전압 측정 / SSR 릴레이 동작 여부 확인 / SSR이 방수등의 220V를 제어하는지 확인해야함]


---
# 주요 개선 사항
## 타이머 로직 최적화
### PIR 미감지 시 4초 후 조명이 정확하게 꺼지도록 개선
## 오류 감지 및 보고 기능 강화
### 예상치 못한 동작 발생 시 UART 및 LoRa로 오류 메시지 전송
## 상태 디버깅 메시지 개선
### UART 디버깅 메시지로 센서 상태 및 조명 상태를 명확하게 전달
---
#  기술 스택
### MCU: STM32L452RET6
### PIR 센서: 사람 움직임 감지
### CDS 센서: 빛 감지
### SSR 릴레이: 조명 ON/OFF 제어
### LoRa 모듈: E22900T22S
### UART 통신: 디버깅 및 데이터 전송
---
#  주요 기능
### 1. PIR 센서 (모션 감지)
사람의 움직임을 감지해 조명을 자동으로 켜고 끔
감지되지 않을 경우 4초 후 조명 OFF
---
### 2. CDS 센서 (조도 감지)
주변 환경의 빛의 세기를 감지
조도가 임계값 이하일 경우 조명 ON
조도가 임계값 이상일 경우 조명 OFF
---
### 3. 조명 상태 관리
SSR 릴레이를 통해 조명을 ON/OFF
장시간 SSR ON 상태일 경우 과열 경고 메시지를 전송
---
### 4. 오류 감지 및 알림
예상치 못한 상태 발생 시 UART 및 LoRa를 통해 오류 메시지 전송
에러 메시지는 실시간으로 확인 가능
---
### 5. LoRa 통신
상태 및 오류 정보를 LoRa 통신을 통해 원격으로 전송
LoRa 통신 상태는 UART 디버깅 메시지를 통해 확인 가능
---
# 시스템 동작 흐름
## 센서 값 읽기

## PIR 및 CDS 센서로 현재 상태 감지

## 조건에 따라 조명 제어

## CDS 센서 값이 임계값 이하 → 조명 ON

## CDS 센서 값이 임계값 이상 + PIR 미감지 → 4초 후 조명 OFF

## 오류 감지
## 예상치 못한 조명 상태 발생 시 오류 메시지 전송
## 상태 정보 전송
## UART 및 LoRa로 상태 및 오류 정보 전송
---
